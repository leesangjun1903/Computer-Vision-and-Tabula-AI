# Models for shape
이 장에서는 2D 및 3D 형태 모델에 대해 다루고 있습니다. 형태 모델의 동기는 두 가지입니다. 

첫째, 장면에서 특정 객체에 속하는 픽셀을 정확히 식별하고자 합니다. 이를 위해 객체의 외곽 윤곽선을 명시적으로 모델링하는 접근 방법이 있습니다.

둘째, 형태는 객체의 정체성 또는 다른 특성을 나타낼 수 있습니다.

이 장에서는 기존의 방법들이 아닌 상향식 접근 방식 대신 하향식 접근 방식을 사용할 것입니다. 여기에서는 객체에 관한 사전 정보를 강제로 부여하여 가능한 윤곽 형태를 제약합니다.

의료 이미징 데이터를 이용한 척추의 2D 기하학적 모델 적합 문제를 예로 들어보겠습니다. 이 복잡한 형태를 몇 개의 파라미터로 특성화해야 함으로써, 이후의 진단 기초로 사용할 수 있습니다. 그러나 이미지 내의 로컬 엣지 정보가 약한 반면, 척추의 가능한 형태에 대한 강한 사전 지식이 유리하게 작용합니다.

## Shape and its representation
모양은 “위치, 크기 및 회전 효과가 필터링된 후 남는 모든 기하학적 정보”로 설명됩니다. 즉, 모양은 유사 변환에 불변한 기하학적 정보를 포함합니다.

각 상황에 따라 유클리드 또는 아핀과 같은 다른 변환 유형으로 이 정의를 일반화할 수도 있습니다.

대수적 모델은 윤곽에 대한 닫힌 형식 표현을 제공한다는 점에서 매력적이지만, 그 적용 가능성은 매우 제한적입니다. 복잡한 형태, 예를 들어 척추와 같은 형상을 설명하는 수학적 표현을 정의하기는 어려운 상황입니다.

이 장의 대부분의 모델은 다른 접근 방식을 채택하며 형태를 일련의 랜드마크 포인트를 사용하여 정의합니다. 랜드마크 포인트는 하나 또는 여러 개의 연속적인 윤곽선에서 이산 표본으로 생각할 수 있습니다. 랜드마크 포인트의 연결성은 모델에 따라 달라지며, 단일 연속 윤곽선을 나타내거나, 감싸여져 닫힌 윤곽선 또는 복잡한 구성으로 열린 윤곽선을 나타낼 수 있습니다.

랜드마크 포인트 간의 보간을 통해 윤곽선을 재구성할 수 있습니다. 예를 들어, 인접한 랜드마크 포인트를 직선으로 연결하여 윤곽선을 형성할 수 있습니다. 보다 정교한 방식에서는 랜드마크 포인트가 스플라인 모델의 제어점으로 작용하여 부드러운 곡선의 위치를 간접적으로 결정할 수 있습니다.

<img width="745" alt="스크린샷 2025-06-16 오후 9 52 21" src="https://github.com/user-attachments/assets/0301889e-2180-4d1a-ada5-e70b642539b6" />

## Snakes
모델 정의 : 매개변수적 윤곽선 모델

N개의 2D 랜드마크 포인트 W = [w1,w2,...,wN]의 구성을 찾는 것. 이 포인트들은 이미지 내 객체의 형태를 설명합니다.

생성 모델: 랜드마크 위치에 대한 생성 모델은 두 가지 주요 구성 요소로 이루어집니다.

우도항(likelihood term): 랜드마크 포인트가 이미지 데이터와 얼마나 잘 일치하는지를 나타냅니다.

사전항(prior term): 다양한 구성의 빈도에 대한 기존 지식을 포함합니다.

랜드마크 포인트가 이미지의 등고선 위에 있을 때, 적합성이 높으며, 그렇지 않을 경우 낮을 수 있습니다.

문제점: 이미지의 평평한 부분에서는 Sobel 엣지 연산자가 0을 반환하므로, 랜드마크 포인트가 평평한 부분에 위치할 경우, 적합성을 개선하기 위한 방향을 파악할 정보가 없다는 단점이 있습니다.

<img width="745" alt="스크린샷 2025-06-16 오후 10 07 58" src="https://github.com/user-attachments/assets/d8455f16-05f6-454d-81e7-b91d8196a873" />

랜드마크 포인트가 이미지의 엣지에 가까울수록 그 가능성이 커지며, 반대로 그 거리가 멀어질수록 가능성이 줄어드는 것은 직관적이고 또한 유용한 접근입니다.

강한 에지에 각각의 포인트가 개별적으로 끌리는 경우, 일관된 형태를 이루지 못할 수 있습니다.

이러한 문제를 피하고 모델을 완성하기 위해, 우리는 낮은 곡률을 가진 부드러운 윤곽을 선호하는 사전(prior)을 정의합니다.

### Inference
경계선 위의 점들을 최적화하고자 하는 과정

최적화가 진행됨에 따라, 윤곽선이 이미지 내에서 최고의 후방 확률을 가진 랜드마크 점들을 찾기 위해 움직이는 모습이 나타납니다. 이러한 이유로 이 윤곽선 모델은 종종 'snake' 또는 'active contour model'로 불립니다.

<img width="745" alt="스크린샷 2025-06-16 오후 10 13 44" src="https://github.com/user-attachments/assets/3cb3f06d-38d9-48ad-9317-8ae77abe1d38" />


얼핏 봤을 때, 최종 윤곽선은 고슴도치의 외부 경계를 잘 따라가지만, 코 부분을 올바르게 구분하지 못했습니다. 코 영역은 곡률이 높고, 이 부분의 규모는 인접한 랜드마크 점 간의 거리보다 작기 때문에 문제가 발생합니다. 이러한 모델은 랜드마크 점 간의 윤곽선을 따라 이미지에 의존하는 가능성을 사용함으로써 개선될 수 있습니다. 이렇게 하면 알려지지 않은 수가 적으면서도 이미지의 밀집된 정보를 활용하는 모델을 개발할 수 있습니다.

최적화 과정에서 지역 최적해에 갇히는 문제와 이미지의 밀도 있는 사용을 통해 모델을 개선하는 방법이 제시되고 있습니다.

모델 개선 방법:

랜드마크 점 사이의 간격에 이미지를 포함하는 가능성(likelihood)을 사용하여 모델을 개선할 수 있습니다.  
최적화 프로세스가 지역 최적값에 갇힐 수 있어, 여러 초기 조건에서 시작하여 가장 높은 확률을 가진 솔루션을 선택할 수 있습니다.

사전 수정:

간격 항(space term)을 정의하여 점들이 미리 정의된 값에 가깝게 배치되도록 유도할 수 있습니다.  
이 수정은 모델의 추론을 용이하게 하여 1D Markov random field 를 형성합니다.


### Problems with the snake model
간단한 스네이크 모델은 몇 가지 한계가 있습니다. 이 모델은 객체 경계의 매끄러움에 대한 정보가 부족하여 다음과 같은 상황에서는 유용하지 않습니다.  

- 이미지 내에서 객체의 위치는 알지만 형태가 불확실한 경우.  
- 객체의 클래스(예: 얼굴)는 알고 있지만 특정 인스턴스(예: 누구의 얼굴)는 모르는 경우.
- 2D 모델로서, 일부 윤곽선이 3D 표면의 카메라 모델을 통해 투영된 것임을 이해하지 못합니다.
- 인체와 같은 관절이 있는 객체를 모델링할 수 없습니다.

## Shape templates
이 모델은 이미지 내에서 객체의 위치, 스케일, 방향을 식별하는 데 초점을 맞추고 있습니다.

형태 템플릿 모델:

정확한 형태를 알고 있다고 가정. 객체의 위치, 크기, 방향을 조정.

변환 매개변수 Ψ:

객체의 형태를 이미지를 매핑하기 위한 파라미터 집합. 유사 변환(lambda)에서는 회전 각도, 스케일링 팩터, 2D 평행 이동 벡터로 구성.

데이터의 가능도:

관측된 이미지 데이터의 가능도는 변환 매개변수에 따라 결정됨. 객체의 랜드마크 포인트와 최단 거리와 관련된 식을 사용.

가능도 함수:
랜드마크 포인트가 이미지의 엣지 근처에 있을 때 가능도가 증가.

### Inference
템플릿 모델의 최적화 문제.

최대 우도(Maximum Likelihood) 접근 방식을 통해 변환 매개변수 Ψ를 찾는 과정.

최대 우도 추정:

로그 우도 L을 최대화하여 변환 매개변수 Ψ를 추정합니다.

비선형 최적화:

해석적 솔루션이 없으므로, 비선형 최적화 기법을 사용해야 합니다.  
목표 함수의 도함수를 계산하기 위해 연쇄 법칙을 사용합니다.

도함수 계산:

두 가지 컴포넌트를 포함:
거리의 변화량을 계산하는 첫 번째 항. 변환에 따라 달라지는 두 번째 항.

최적화 과정:

다양한 초기 위치에서 최적화를 재시작하고, 최적 우도를 선택하는 방식.

<img width="745" alt="스크린샷 2025-06-16 오후 10 23 39" src="https://github.com/user-attachments/assets/0adb779b-b2fd-4e28-9f4f-782282c90064" />

신뢰할 수 있는 최적화의 수렴이 보장되지 않는 점은 아쉬운 사항입니다. Snake 모델의 경우, 다음과 같은 방법으로 문제를 해결할 수 있습니다:

다양한 시작점 사용: 여러 위치에서 최적화를 재시작하여 전체 최대 로그 가능성을 가진 솔루션을 선택합니다.

초기화 개선: 예를 들어, 초기 위치를 얼굴 탐지기의 출력을 바탕으로 설정할 수 있습니다.

사전 지식 적용: 가능한 변환 파라미터에 대한 사전 지식을 사용하여 솔루션의 범위를 제한하고 최대 사후 확률(maximum a posteriori) 공식을 적용할 수 있습니다.

이와 같은 방법들을 통해 최적화 과정에서의 신뢰성을 높일 수 있습니다.

### Inference with iterative closest point algorithm
템플릿 모델을 추정할 때 사용하는 반복적 가장 가까운 점(ICP) 알고리즘 : iterative closest point (ICP) algorithm 에 대한 것입니다. 

ICP 알고리즘은 이미지의 랜드마크 점과 모델의 랜드마크 점을 일치시키며, 최적의 변환을 찾는 방법입니다.

단계별 절차:

매 랜드마크 점 ( $w_n$ )을 현재 매개변수 ( $\Psi$ )를 사용하여 변환합니다.
변환된 점 ( $w'_n$ )을 가장 가까운 이미지 점 ( $y_n$ )과 연결합니다.
랜드마크 점과 이미지 점의 최적 매핑을 계산하여 매개변수 ( $\Psi$ )를 업데이트합니다.
이 과정을 수렴할 때까지 반복합니다.
데이터 연관: 반복하는 과정에서 선택된 최근접 점이 변동하며, 이에 따라 변환 매개변수도 변화합니다.

변형된 접근법: 랜드마크 점을 윤곽선에 수직인 방향으로 매칭하는 방법도 고려되며, 이는 검색을 1D로 제한하여 더 견고한 적합을 가능하게 합니다. 이는 일반적으로 부드러운 윤곽 모델에 유용합니다.

<img width="745" alt="스크린샷 2025-06-17 오전 11 15 08" src="https://github.com/user-attachments/assets/f3a599f2-adc2-4d7e-90bb-913f2544f78d" />

이러한 알고리즘을 통해 템플릿 모델링의 정확성을 높일 수 있습니다.

## Statistical shape models
통계적 형태 모델(statistical shape models), 능동 형태 모델(active shape models), 혹은 점 분포 모델(point distribution models)에 대한 것.

이 모델들은 특정 클래스의 객체 내 변화를 설명하며, 이전에 본 적이 없는 특정 개체에게도 적응할 수 있습니다.

모델은 N개의 랜드마크 포인트의 위치 ${wn}N, n=1$로 형태를 설명하며, 이러한 점들의 가능성은 이미지 내 엣지에 대한 근접성에 따라 달라집니다.  
이때 훈련 이미지 데이터 xi에 대한 가능성(likelihood)은 정의할 수 있습니다.

여기서 $win$은 i번째 훈련 이미지의 n번째 랜드마크 포인트이며, $dist[•,•]$는 이미지 내 가장 가까운 Canny 엣지까지의 거리를 계산하는 함수입니다.

또한 랜드마크 포지션에 대한 복합 벡터 $w_i$를 정의하고, 이것의 밀도 $Pr(wi)$를 정규 분포로 모델링하여 평균 µ와 공분산 Σ를 통해 객체의 평균 형상과 다양한 변화를 설명합니다.

이 모델은 템플릿 모델과 스네이크 모델의 중간에 위치하여, 특정 클래스 내에서 변화하는 형태를 효과적으로 다루는 데 유용합니다.

### Learning
학습의 목표는 훈련 데이터를 기반으로 매개변수 θ = {µ, Σ}를 추정하는 것입니다. 각 훈련 예제는 수작업으로 주석이 달린 여러 랜드마크 점들로 구성됩니다. 그러나 훈련 예제는 일반적으로 기하학적으로 정렬되지 않은 상태로 제공됩니다.

즉, 우리는 변형된 데이터 예를 $w'ᵢ = [wᵀᵢ₁, wᵀᵢ₂, ..., wᵀᵢₙ]ᵀ$ 형태로 수신하며, 이는 변환될 수 있습니다.

여기서 파라미터 µ와 Σ의 정규 분포를 학습하기 전에, 우리는 이 예제들을 역변환을 사용하여 정렬해야 합니다.

여기서 ${Ψ^{-1}_i}$는 역변환의 매개변수입니다. 이와 같은 정렬 과정을 통해 모델 학습에 필요한 정확한 데이터를 확보할 수 있습니다.

#### Alignment of training examples
- Procrustes analysis
주어진 훈련 샘플들을 정렬하는 방법으로, 평균 형태(µ)를 추정하고 변환 매개변수(Ψ)를 반복적으로 업데이트하는 과정을 포함합니다. 요약하자면:

변환 매개변수 업데이트:

각 샘플의 변환을 최적화하여 평균 형태 µ와의 차이를 최소화합니다.

평균 템플릿 업데이트:

각 샘플을 변환한 후 평균을 계산해 평균 형태를 갱신합니다. 이후 이 평균 벡터를 정규화해야 고유한 절대 크기를 정의할 수 있습니다.  
최적의 결과를 얻기 위해 이 두 단계를 반복하며, 수렴에 도달한 후 통계 모델을 적합할 수 있습니다. 이 방법은 얼굴 형태 모델과 같은 다양한 응용 분야에 활용됩니다.

<img width="745" alt="스크린샷 2025-06-17 오전 11 31 16" src="https://github.com/user-attachments/assets/9ce91290-3d80-4851-87d1-e1d665a07763" />

### Inference
모델 적합화: 랜드마크 포인트와 변환 파라미터를 최적화하여 이미지와 일치시키는 것이 목표입니다.

교대 최적화 기법: 고정된 랜드마크 포인트로 변환 매개변수를 추정하고, 고정된 변환 매개변수로 랜드마크 포인트를 추정하는 과정을 반복합니다.

통계적 형태 모델: 이미지의 특성에 맞게 모델의 형태를 조정할 수 있는 장점이 있지만, 변수의 수가 많아 최적화 과정이 비용이 크다는 단점이 있습니다.

모델 간소화의 필요성: 변수가 많고 훈련 데이터가 필요한 문제를 해결하기 위해 더 적은 변수를 사용하는 모델에 대한 설명이 이어질 것입니다.

이와 같은 접근 방법은 이미지 내 물체의 변형에 대응할 수 있도록 하는 데 효과적일 수 있지만, 컴퓨팅 자원과 데이터 세트의 제약을 고려해야 한다는 점이 매우 중요합니다.

## Subspace shape models
서브스페이스 형태 모델에 대한 설명.

이 모델은 랜드마크 점들의 공분산 내재 구조를 활용하여 형태 벡터를 K차원 선형 서브스페이스의 근처에 위치하는 것으로 가정합니다. 다음은 주요 개념에 대한 요약입니다.

형태 벡터: 형태 벡터 ( $w_i$ )는 평균 형태 ( $\mu$ )와 K개의 기저 함수에 의해 정의된 선형 조합으로 표현됩니다.

기저 함수: 행렬 ( $\Phi$ )는 K개의 기저 함수를 열로 가지고 있으며, 각 형태 벡터는 하드코딩된 변수 ( $h_i$ )에 의해 가중치가 조정됩니다.

근사화: 형태 벡터 ( $w_i$ )를 ( $\mu + \sum_{k=1}^{K} \phi_k h_{ik}$ )로 근사할 수 있으며, 이는 랜드마크 점 대신 K개의 가중치 벡터를 사용하여 형태를 표현할 수 있게 해줍니다.

효율성: 얼굴 모델과 같은 제한된 데이터셋에서는 K를 작게 설정해도 근사화가 뛰어난 성능을 발휘합니다.

이 모델은 형태 벡터를 근사함으로써 계산 비용을 절감하는 데 기여합니다. 이어서 이 모델의 다양한 양을 찾는 방법을 자세히 살펴볼 예정입니다.

### Probabilistic principal component analysis
확률적 주성분 분석(Probabilistic Principal Component Analysis, PPCA) 모델은 특정 차원 축소 기법으로, 확률적 관점에서 정의되고 있습니다.

모델의 핵심 요소는 다음과 같습니다:

확률 분포: ($Pr(w_i|h_i,\mu,\Phi,\sigma^2) = \text{Norm}_{w_i}[\mu + \Phi h_i, \sigma^2 I]$)로 표현되며, 여기서 ($\mu$)는 평균 벡터, ($\Phi$)는 기초 함수(주성분)를 포함하는 행렬입니다.

은닉 변수, hidden variable: ($h_i$)는 기초 함수를 가중치화하여 최종 위치를 결정하는 K×1의 은닉 변수입니다.

사전 분포: 은닉 변수 ($h_i$)에 대한 사전 분포는 ($Pr(h_i) = \text{Norm}_{h_i}[0,I]$)로 주어집니다.

결과 해석: ( $Pr(w_i)$ )의 분포는 두 부분으로 나뉘어 있으며, 하나는 변형으로 인한 분포(($\Phi\Phi^T$)), 또 다른 하나는 데이터의 추가적인 변동을 설명하는 노이즈(term ($\sigma^2 I$))로 구분됩니다.

이러한 모델을 통해, PPCA는 차원 축소와 데이터의 노이즈 분석을 통합하여 더욱 효과적인 데이터 표현을 가능하게 합니다.

### Learning
PPCA(Probabilistic Principal Component Analysis) 모델은 요인 분석(factor analysis)과 매우 밀접한 관련이 있으며, 그 차이는 노이즈 항 σ²I가 PPCA에서는 구형인 반면 요인 분석에서는 대각형 형태를 띤다는 점입니다. 이 차이는 중요한 의미를 가집니다. PPCA 모델은 닫힌 형태로 학습이 가능하지만, 요인 분석 모델은 EM 알고리즘과 같은 반복적인 방법이 필요합니다.

학습에서는 정렬된 훈련 데이터 세트 { $w_i$ }를 사용하여 PPCA 모델의 매개변수 µ, Φ, σ²를 추정합니다. 여기서 각 $w_i$ 는 랜드마크 포인트의 x 및 y 위치를 포함하는 벡터입니다. 평균 매개변수 µ를 훈련 예제의 평균으로 설정한 후, $W = [w1−µ, w2−µ,..., wI−µ]$ 형태로 0 중심 데이터를 구성하고, $WW^T$ 의 특이값 분해(SVD)를 통해 매개변수를 계산합니다.

고차원 데이터의 경우 $D×D$ 행렬 $WW^T$의 고유값 분해는 계산 비용이 많이 들 수 있습니다. 훈련 예제 수 I가 D보다 적은 경우, $I×I$ 산포 행렬(scatter matrix) $W^TW$의 SVD를 계산해 U를 추출하는 것이 효율적입니다.

Φ의 기저 함수에 대해 다음과 같은 점을 주목할 수 있습니다:

Φ의 열에 있는 기저 함수(주성분)는 서로 직교합니다.  
기저 함수는 순서가 있으며, Φ의 첫 번째 열은 가장 많은 분산을 설명합니다.  

이러한 기저 함수를 통해 PPCA 모델을 시각화할 수 있으며, 숨겨진 변수 $h_i$ 를 조작하여 각 기저 함수의 기여를 밝혀낼 수 있습니다. 

<img width="745" alt="스크린샷 2025-06-17 오후 12 54 43" src="https://github.com/user-attachments/assets/13a8900e-2a3e-47d6-95f7-54299902a2e3" />

예를 들어, hi를 $±[1,0,0,...,0]$으로 설정하면 첫 번째 기저 함수를 조사할 수 있습니다.  
이러한 방식으로 PPCA 모델의 해석을 보다 명확하게 할 수 있습니다.

<img width="745" alt="스크린샷 2025-06-17 오후 12 55 56" src="https://github.com/user-attachments/assets/f8d8d3ff-f0b3-48cf-9803-06f64aa46910" />

### Inference

모델 최적화: 비선형 최적화를 통해 형태 모델을 적합하며, 반복적인 프로세스를 사용하여 마크 포인트를 업데이트합니다.

단계:

현재 랜드마크 포인트를 계산합니다.  
각 포인트를 이미지로 변환하고 최근접의 엣지 포인트와 연결합니다.  
각 포인트에 대해 가장 잘 매핑되는 변환 매개변수를 계산합니다.  
형태 모델은 반복 과정을 통해 수렴할 때까지 업데이트됩니다.  
히든 변수 업데이트: 히든 변수를 최적화하는 과정은 로그 확률을 최대화하는 형태로 표현됩니다.  

coarse-to-fine fitting: 저해상도 이미지에 대해 거친 모델을 적용한 뒤, 이를 기반으로 더 자세한 고해상도 모델을 적합합니다.

이러한 방법들은 일반적으로 '능동 형태 모델(active shape models)'로 알려져 있으며, 이미지의 형태에 유연하게 적응하기 위해 고안되었습니다. 하지만 모델이 랜드마크 포인트를 일반적인 엣지로 매핑할 뿐, 더 많은 이미지 정보를 활용하지 못하는 한계가 있습니다.

<img width="745" alt="스크린샷 2025-06-17 오후 1 05 19" src="https://github.com/user-attachments/assets/e2c1bc0f-554c-47c1-8884-770a478cc6b7" />

## Three-dimensional shape models
3차원 공간에서의 잠재 공간 형상 모델에 대해 설명하고 있습니다. 2차원과 유사하게 작동하나, 주요 차이점은 다음과 같습니다:

랜드마크 포인트: 3차원 데이터의 경우 랜드마크 포인트가 3x1 벡터로 표현되어 3D 공간 내 위치를 결정합니다.

전역 변환: 2D에서의 전역 변환을 3D로 일반화해야 합니다. 3D 아핀 변환은 이동, 회전, 비대칭, 스케일링을 포함하며, 총 12개의 매개변수로 결정됩니다.

우도 조정: 3D 우도를 조정하려면 3D 엣지 오퍼레이터의 유사체를 작성하여, 세 개의 미분 필터의 평균 제곱근 값을 사용해야 합니다. 이를 통해 3D 엣지 오퍼레이터가 높은 값을 반환하는 지역에서 우도가 높아지는 표현을 구성합니다.

<img width="745" alt="스크린샷 2025-06-17 오후 1 13 10" src="https://github.com/user-attachments/assets/2c799d49-6d91-4b8a-a2f2-d612f70bd175" />

## Statistical models for shape and appearance
고차원 데이터를 설명하는 보다 효과적인 모델, 즉 형상과 픽셀 강도를 동시에 설명하는 활성 형태 모델(Active Appearance Model, AAM)에 대해 논의하고 있습니다. 

이 모델은 다음과 같이 구성됩니다.

숨겨진 변수: 이 모델의 핵심은 형상과 픽셀 강도를 뒷받침하는 저차원의 숨겨진 변수 ( $h_i$ )입니다.

형상 데이터 생성: 형상 데이터 ( $w$ )는 숨겨진 변수를 통해 기저 함수 ( $\Phi_w$ )의 가중치로 형성되고, 평균 벡터 ( $\mu_w$ )가 추가됩니다.

픽셀 값 생성: 관찰된 픽셀 값 ( $x_i$ )는 형상 ( $w_i$ ), 글로벌 변환 매개변수 ( $\Psi_i$ ), 그리고 숨겨진 변수 ( h_i )에 의존하여 생성됩니다.

이 과정은 세 단계로 나뉘어 있으며, 각 단계에서 강도 값과 형상이 동일한 숨겨진 변수에 의존하기 때문에 상관관계를 효과적으로 설명할 수 있습니다. 이러한 방식으로 만들어진 이미지들은 기존의 형상 모델보다 더 선명하게 나타납니다.

<img width="745" alt="스크린샷 2025-06-17 오후 1 14 28" src="https://github.com/user-attachments/assets/d853665c-7e3d-474f-89d4-297f7cba6ac6" />

모델의 이러한 구조는 형상과 외관의 상호작용을 잘 설명하고, 예를 들어 입이 열릴 때 치아가 드러나는 것과 같은 변화를 포착할 수 있습니다.

#### Warping images
이미지를 변형하는 간단한 접근법에 관한 것입니다. 기본적으로 랜드마크 포인트를 삼각형으로 나누고, 각 삼각형에 대해 부분적으로 아핀 변환을 사용하는 방식입니다.

구체적으로 말씀드리면:

삼각형의 Canonical 위치: 기준 삼각형의 꼭짓점 좌표가 μ에 저장됩니다.
변형 후 삼각형 좌표: 변형 후 꼭짓점의 좌표는 $trans[μw + Φwhi, Ψi]$에 저장됩니다.
이러한 접근법을 통해 각 삼각형이 원하는 최종 위치로 정확하게 변형될 수 있습니다. 

### Learning
학습에서는 여러 이미지로부터 변형된 랜드마크 포인트 { $wi$ }와 관련된 픽셀 데이터 { $xi$ }를 활용하여 매개변수 {µw, Φw, σ²w, µx, Φx, σ²x}를 학습하고자 합니다. 모델이 복잡하므로 간단화하기 위해 다음 두 가지 효과를 제거합니다:

랜드마크 포인트에 대한 변형의 효과 제거: 일반화된 프로크루스테스 분석(generalized Procrustes analysis)을 수행합니다.

이미지 데이터에 대한 변형 및 왜곡의 효과 제거: 각 훈련 이미지를 평균 형태로 변형하여 정렬된 랜드마크 포인트 세트와 동일한 형태의 이미지 세트를 생성합니다.

이렇게 정렬된 데이터는 간단한 모델로 설명할 수 있으며, 해당 모델로 매개변수를 학습하기 위해 EM 알고리즘의 수정된 버전을 사용할 수 있습니다.

### Inference
이미지의 형태와 외관을 결정짓는 숨겨진 변수를 찾는 inference에 관한 것입니다. 특히, 얼굴 모델을 이용한 성별 구별 및 최대 우도 절차에 대해 설명하고 있습니다.

주요 내용은 다음과 같습니다:

모델식: 모델은 랜드마크 포인트가 정확히 서브스페이스에 위치한다고 가정합니다.

가능도 표현: 관측 데이터의 가능도는 정규 분포를 기반으로 하며, 최소 제곱 비용 함수를 유도합니다.

최적화 방법: Gauss-Newton 방법을 사용하여 비용 함수를 최적화합니다. Jacobian 행렬을 통해 매개변수의 변화에 따른 민감도를 고려합니다.

이 통계적 형태 및 외관 모델의 성공적인 적합은 초기값의 품질과 최적화 과정의 전략에 의존합니다.

<img width="745" alt="스크린샷 2025-06-17 오후 1 23 35" src="https://github.com/user-attachments/assets/5274fc52-53b3-4752-81a3-6d9c943b942f" />

## Non-Gaussian statistical shape models
통계적 형태 모델은 일반적으로 정상 분포로 설명되는 제약된 형태 변형에 효과적입니다.  
하지만 비정상 분포에서 더 복잡한 모델이 필요할 수 있습니다. 이러한 경우, 혼합 PPCAs 또는 가우시안 프로세스 잠재 변수 모델(Gaussian process latent variable model , GPLVM)을 활용할 수 있습니다.  
GPLVM은 PPCA 모델을 확장하여 숨겨진 변수를 고정된 비선형성을 통해 변환하고, 이후 기저 함수에 의해 가중치를 부여하여 복잡한 비정상 분포를 모델링할 수 있도록 합니다.

### PPCA as regression
PPCA 모델의 표현:

PPCA 모델은 다음과 같이 정의됩니다:

$[
Pr(w|µ,Φ,σ^2) = Pr(w,h|µ,Φ,σ^2)dh = Pr(w|h,µ,Φ,σ^2)Pr(h)dh
]$

이 식에서 (Pr(w|h,µ,Φ,σ^2))는 회귀 모델과 관련이 있습니다. 예를 들어 (w_d)의 경우 다음과 같이 표현할 수 있습니다:

$[
Pr(w_d|h,µ,Φ,σ^2) = Norm_{w_d} [µ_d + φ^T_d h, σ^2]
]$

이 식은 행렬 (Φ)의 d번째 행과 관련된 회귀 모델을 나타냅니다.

데이터 세트 분석:

<img width="745" alt="스크린샷 2025-06-17 오후 1 46 49" src="https://github.com/user-attachments/assets/783180f8-e2a5-4b65-8280-a662bbaeaa87" />

2D 데이터 세트 (${w_i}{i=1}^I$)은 1D 숨겨진 변수 (${h_i}{i=1}^I$)로 설명됩니다. 각 2D 차원 (w)는 일반적으로 공통의 숨겨진 변수에 대해 다른 회귀 모델로 설명됩니다. 

그러므로 (w_1)과 (w_2)는 각각 다음과 같이 모델링됩니다:

(w_1 = µ_1 + φ^T_1 h), (w_2 = µ_2 + φ^T_2 h)
이러한 공통 변수가 분포 (Pr(w))에서 관찰되는 상관관계를 유도합니다.

밀도 형성 과정:

정해진 값 (h)에 대해 ($w_1$)과 ($w_2$) 각각의 예측이 이루어지며, 각 예측에는 동일한 분산을 가진 노이즈가 추가됩니다. 이로 인해 2D 구형 정규 분포가 생성됩니다. 마지막으로, (h)의 가능한 모든 값에 대해 정규 우선 분포로 가중 평균을 취함으로써 최종 밀도를 형성하게 되며, 이는 다음과 같은 형태를 가집니다:

$[
N(µ, φφ^T + σ^2I)
]$

이 결과는 비구형 공분산을 가진 정규 분포로 나타납니다.

이러한 관점은 PPCA 모델을 보다 깊이 이해하고 회귀 분석과 관련된 의미를 파악하는 데 도움을 줍니다.

### Gaussian process latent variable model
GPLVM은 복잡한 밀도를 표현하는 데 유용하며, 이를 위해 선형 회귀 모델 대신 비선형 회귀 모델을 사용합니다. 이 모델의 주요 특징은 다음과 같습니다:

<img width="745" alt="스크린샷 2025-06-17 오후 1 51 25" src="https://github.com/user-attachments/assets/22bc48e9-1d5b-473d-bf36-66f6e3ed51eb" />

회귀 매개변수 처리: 가우시안 프로세스 회귀에서 회귀 매개변수(µ 및 Φ)를 주변화하여 학습 과정에서 이를 추정할 필요가 없습니다.

숨겨진 변수 추정: 숨겨진 변수(h)를 닫힌 형태로 주변화할 수 없기 때문에, 훈련 과정 동안 이 변수를 추정해야 합니다.

이러한 특성들은 모델의 학습 및 추론에서 새로운 도전을 제시합니다.

#### Learning
본 모델은 다변량 데이터를 기반으로 다변량 세계 상태를 예측하는 데 집중합니다. 

간단히 정리하자면:

가우시안 프로세스 회귀(Gaussian process regression model):

세계 상태 ( w )를 다변량 데이터 ( X )로부터 예측.
매개변수 ( $\phi$ )는 모델에서 시행 착오로 제외되고, 잡음 매개변수 ( $\sigma^2$ )는 주변 가능성을 최대화함으로써 결정.

GPLVM:

세계 값 ( W )를 다변량 숨겨진 변수 ( H )로부터 예측.  
숨겨진 변수 ( H )의 값은 동시에 추정되어야 하며, 이 과정에서 최적화 문제는 폐쇄 형태로 해결될 수 없음.  
여러 차원 및 훈련 샘플에 대한 정규화 과정이 포함됨.  
이 두 모델 모두 커널 함수 ( K )의 역할과 최적화 과정이 중요한 요소로 작용합니다.

#### Inference
주어진 내용을 이해하기 위해서는 숨겨진 변수 ( $h^*$ )와 관련된 확률 분포 및 샘플링 기법을 살펴보아야 합니다. 다음은 주요 포인트를 정리한 내용입니다:

확률 분포: 새로운 숨겨진 변수 ( $h^*$ )에 대한 ( d )차원 세계 ( $w^\*_{d}$ )의 분포는 주어진 식 (17.44)로 표현됩니다. 

이 식은 여러 변수의 영향을 고려하여 $w^*_{d}$ 를 예측하는 데 사용됩니다.

모델 샘플링: 모델에서 샘플링할 때는 우선 ( h^* )를 사전 분포로부터 선택하고, 이후 이 값을 사용하여 랜드마크 ( $w^*$ )에 대한 확률 분포를 예측합니다.

확률 평가: 새로운 샘플 ( $$w^*$$ )의 확률을 평가하기 위해 (17.45) 식을 사용합니다. 그러나 본 적분은 닫힌 형태로 계산할 수 없으므로, 다른 접근 방식이 필요합니다.

대안적 접근법:

( $h^*$ )에 대해 극대화하는 방법.
훈련 데이터 위치에서의 델타 함수 집합으로 ( Pr(h^*) ) 밀도를 근사화하여 적분을 각 샘플에 대한 합으로 대체하는 방법.
이런 방식으로 접근하면 모델링 과정에서 효율적으로 ( w^* )와 관련된 확률을 평가할 수 있습니다.

#### Application to shape models
GPLVM은 복잡한 데이터 구조를 모델링하는 데 유용하며, 얼굴의 형태와 같은 더 큰 변화를 캡처할 수 있습니다.  
반면, PPCA는 단일 정규 분포에 기반하여 데이터의 변화를 설명하기 때문에 제한적입니다. GPLVM은 다차원 데이터의 잠재 구조를 더 잘 포착할 수 있는 유연성을 제공합니다.

<img width="745" alt="스크린샷 2025-06-17 오후 1 58 16" src="https://github.com/user-attachments/assets/a0f23c86-f78e-4711-9cfc-7c615e03b40b" />

## Articulated models
통계적 형태 모델은 형태 변동이 상대적으로 적을 때 효과적입니다. 그러나 특정 객체에 대한 사전 지식이 강한 경우, 예를 들어 인체 모델에서는 두 개의 팔과 두 개의 다리가 있고 이들이 본체와 특정한 방식으로 연결되어 있다는 점에서 다른 접근이 필요합니다. 이러한 설명을 바탕으로, 관절 모델은 관절 각도와 카메라와의 전체 변환을 통해 모델을 매개변수화합니다.

관절 모델의 핵심 아이디어는 각 부분의 변환이 누적된다는 것입니다. 즉, 발의 위치는 하체의 위치에 의존하고, 하체의 위치는 상체의 위치에 따라 달라집니다. 이는 운동 사슬(kinematic chain)로 알려져 있습니다.

3D 손 모델을 구성할 때, 잘린 쿼드릭(truncated quadrics)에서 구조화된 모델을 사용할 수 있습니다. 쿼드릭은 삼차원으로 일반화된 원뿔 형태이며, 실린더, 구, 타원체 등의 다양한 형태를 나타낼 수 있습니다. 이 모델은 39개의 쿼드릭으로 구성되며, 이를 통해 27개의 자유도를 가집니다.

이 모델은 카메라에서 관찰한 이미지를 기반으로 최적화하여 피팅을 수행하는데, 이 과정에서 최적화가 로컬 최소값에 수렴할 위험이 있으며, 이미지는 종종 모호할 수 있습니다.  
그러나 여러 카메라로부터 객체를 관찰하면 많은 모호함이 해소되며, 모델을 연속된 프레임을 통해 추적하는 경우에도 초기 위치를 기반으로 피팅이 용이해집니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 03 00" src="https://github.com/user-attachments/assets/8709c6c2-5995-4872-95c6-cdf37375c2a5" />

## Applications
첫째, 3D 버전의 활성 외관 모델인 얼굴 모델을 고려하겠습니다. 이 모델은 다양한 얼굴 표현과 외형을 포착하여 컴퓨터 그래픽스와 인식 분야에서 활용됩니다.

둘째, 인체 모델에서는 관절 모델과 형태의 서브스페이스 표현 개념을 결합한 모델을 논의하겠습니다. 이 모델은 인체의 포즈와 움직임을 보다 정교하게 표현할 수 있도록 돕습니다.

이러한 3D 모델들은 가상 현실, 애니메이션 및 의료 분야에서 매우 유용합니다.

### Three dimensional morphable models
Blanz와 Vetter (1999)는 얼굴의 3D 형태 및 Appearance에 대한 통계 모델을 개발하였습니다. 이 모델은 200개의 레이저 스캔을 기반으로 하며, 각 얼굴은 약 70,000개의 3D 정점과 RGB 텍스처 맵으로 표현됩니다. 캡처된 얼굴들은 전역 3D 변환이 제거된 후, 광학 흐름을 바탕으로 정점이 등록됩니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 05 59" src="https://github.com/user-attachments/assets/32af5756-9655-4d05-b452-45a3c380dedf" />

모델은 아래의 주요 파라미터들을 포함하여 실물 사진에 맞추어집니다:

형태를 결정하는 기저 함수의 가중치  
텍스처를 결정하는 기저 함수의 가중치  
카메라와 물체의 상대 위치  
주변 및 방향성 조명의 RGB 강도  
각 이미지 RGB 채널의 오프셋과 이득  

이 과정의 끝에서 얼굴의 형태와 텍스처를 완전히 파악할 수 있으며, 이는 다양한 각도에서 보거나 조명을 추가하는 것이 가능합니다.

이 모델은 얼굴 인식에도 활용되었으며, 매튜스 외(2007)는 이 모델의 단순화된 버전을 제시하여 비디오 시퀀스에 대한 적합 알고리즘을 개발하였습니다. 이렇게 함으로써 실시간으로 얼굴의 포즈와 표정을 추적할 수 있게 되었습니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 06 33" src="https://github.com/user-attachments/assets/4b81732d-ab86-45ef-bb87-43651f079223" />

이와 같은 연구는 영화 및 비디오 게임의 CGI 캐릭터에 얼굴 표정을 캡처하는 데 사용되고 있습니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 08 09" src="https://github.com/user-attachments/assets/25c80606-5ed1-40c2-99e5-d7316a6e4123" />

### Three-dimensional body model
Anguelov et al. (2005)은 관절 구조와 서브스페이스 모델을 결합한 3D 신체 모델을 제안하였습니다. 이 모델은 신체의 골격을 설명하는 관절 모델과 개인의 형태 변화를 설명하는 서브스페이스 모델로 구성됩니다. 주요 특징은 삼각형 집합으로 신체 표면이 정의된다는 것입니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 08 35" src="https://github.com/user-attachments/assets/a8d82885-a197-43e9-81c6-a93cf7727e61" />

모델 생성 과정
위치 변형: 최근 접합 관절에 따라 삼각형의 위치가 변형됩니다. 이 변형은 회귀 모델을 사용하여 결정되며, 근육의 섬세한 변형 효과를 만듭니다.

PCA 모델 적용: 개인의 특징(신체 형태 등)에 따라 삼각형의 위치가 또 다시 변형됩니다.

3D 공간 왜곡: 골격의 위치에 따라 삼각형이 3D 공간에서 왜곡됩니다.

응용 예
부분 스캔 보완: 이 모델은 인간의 부분 스캔을 완전히 캡처하는 데 활용될 수 있습니다. 스캔된 일부 정보의 부족함을 보완하여 전체 모델을 생성합니다.

모션 캡처 기반 애니메이션: 모션 캡처 스튜디오에서 배우의 신체 위치를 추적하여 3D 모델의 골격 위치를 찾고, 회귀 모델로 근육 변형을 조정합니다. 이를 통해 비디오 게임이나 영화의 캐릭터 애니메이션을 생성하는 데 사용됩니다.

<img width="745" alt="스크린샷 2025-06-17 오후 2 08 51" src="https://github.com/user-attachments/assets/9eed4613-9b1b-434e-87fb-42774893ed75" />

# Note
## Snake Model
활동 윤곽 모델, 즉 스네이크(Snake)는 Kass 외(1987)에 의해 처음 도입되었습니다. 이후 다양한 수정이 이루어져 수렴을 촉진하는 방법들이 개발되었으며, 그 중에는 풍선화 항(balooning term, Cohen 1991)과 그래디언트 벡터 흐름(gradient vector flow, Xu and Prince 1998) 같은 새로운 외적 힘이 포함됩니다.

원래 윤곽은 연속 객체로 간주되었으나, 이후 연구에서는 윤곽을 이산(discrete)으로 취급하고 최적화를 위해 탐욕 알고리즘(greedy algorithms)이나 동적 프로그래밍(dynamic programming) 방법을 사용했습니다(Amini 외, 1990; Williams 및 Shah, 1992). 추가 연구는 객체 형태에 대한 사전 정보를 활용하여 활동 윤곽 모델로 발전했습니다(Cootes 외, 1995). 이 연구 분야는 여전히 활발히 진행되고 있습니다(Bergtholdt 외, 2005; Freifeld 외, 2010).

이 장에서 논의되는 윤곽 모델은 매개변수(parametric)적이라고 하며, 이는 형태가 명시적으로 표현된 것을 의미합니다. 초기의 매개변수 활동 윤곽에 대한 요약은 Blake와 Isard(1998)에서 확인할 수 있습니다. 또한, 이미지 영역에서 정의된 함수의 수준 집합(level sets)에 의해 윤곽이 암묵적으로 정의되는 암시적(nonparametric) 윤곽에 대한 연구도 진행되고 있습니다(Malladi 외, 1994; Caselles 외, 1997). 이러한 모델에 사전 지식을 적용하는 것에도 많은 관심이 집중되고 있습니다(Leventon 외, 2000; Rousson 및 Paragios, 2002).

## Bottom-up
최근의 연구에서는 최상위(top-down) 접근법뿐만 아니라 최하위(bottom-up) 접근법에 대한 진전이 두드러지고 있습니다. 최하위 접근법은 가장자리 조각들을 결합하여 일관된 형태를 형성하는 과정입니다.

예를 들어, Opelt 외(2006)는 "경계 조각 모델(Boundary fragment model)"을 소개하여, 가장자리 조각의 쌍이 객체의 중심 위치에 투표하여 지지도가 가장 높은 위치를 찾음으로써 객체를 감지합니다. Shotton 외(2008)는 유사한 모델을 제시하며, 스케일 불변성을 포함하고 이미지의 국소 영역을 탐색하여 더 큰 장면의 일부인 객체를 식별합니다. Leordeanu 외(2007)는 기능 간의 쌍방 제약을 도입했고, Chia 외(2010)는 선분 및 타원과 같은 지역 기하학적 원소의 조합을 사용하여 윤곽선을 재구성하는 연구를 진행했습니다.

## Subspace models
이 모델들은 다양한 단위로 표현된 양의 공동 분포를 모델링하는 데 유용하며, 비선형 PCA 및 팩터 분석의 일반화가 비정규분포 사례로 확장되었다고 언급되고 있습니다. 이러한 모델들은 복잡한 데이터의 패턴을 이해하는 데 중요한 역할을 합니다.

## Active Shape Models, Active Appearance Models
활성 형태 모델(Active Shape Models)과 활성 외관 모델(Active Appearance Models)에 대한 더 자세한 정보는 다음과 같은 문헌에서 찾아보실 수 있습니다:

활성 형태 모델: Cootes et al. (1995)
활성 외관 모델: Cootes et al. (2001), Stegmann (2002)
Jones와 Soatto (2005)는 활성 외관 모델에 흥미로운 확장을 제시하였으며, 객체를 여러 겹으로 모델링하였습니다. 최근에는 활성 외관 모델의 적합 알고리즘의 효율성을 향상시키는 데 중점을 두고 연구가 진행되었습니다(Matthews and Baker 2004; Matthews et al. 2007; Amberg et al. 2009).

이 모델들은 얼굴 인식, 얼굴 자세 추정, 표정 인식(Lanitis et al. 1997), 그리고 입술 읽기(Matthews et al. 2002)와 같은 여러 작업에 적용되었습니다. 또한, 일부 연구자들은 비선형 접근 방식을 포함한 혼합 모델(Cootes and Taylor 1997), 커널 PCA(Romdhani et al. 1999), GPLVM(Huang et al. 2011) 기반 시스템을 연구하였습니다.

## 3D Morphable models
3D 변형 모델(3D Morphable Models)은 블란츠(Blanz)와 베터(Vetter)에 의해 1999년에 처음 소개되었습니다. 이후 이 모델은 다음과 같은 다양한 분야에 활용되었습니다:

이미지 및 비디오 편집: Blanz et al. (2003)
얼굴 인식: Blanz and Vetter (2003) 및 Blanz et al. (2005)
3D 얼굴 추적: Matthews et al. (2007)
또한, 이와 관련된 모델이 차량에 대해서도 개발되었습니다(Leotta and Mundy, 2011). 이러한 연구들은 3D 얼굴 및 구조 인식 기술의 발전에 기여하고 있습니다.

## Body Tracking
인체 추적 분야에서는 다양한 표현을 바탕으로 한 생성 모델들이 개발되었습니다. 여기에는 원통형(Hogg 1983), 타원형(Bregler and Malik 1998), 막대형(Mori et al. 2004), 메쉬(Shakhnarovich et al. 2003) 모델이 포함됩니다.

추가적으로, 2D 모델(예: Felzenszwalb and Huttenlocher 2005)과 멀티카메라 설정을 통한 데이터 구분 연구도 진행되었습니다(Gavrila and Davis 1996). 또한, 시간 순서에 따른 신체 추적 모델에 대한 관심이 높아지고 있으며, 신체 움직임의 물리적 지식을 활용하여 결과를 개선하려는 최근 연구도 있습니다(Brubaker et al. 2010).

인간 움직임 추적에 대한 다양한 리뷰는 Forsyth et al. (2006), Moeslund et al. (2006), Poppe (2007), Sigal et al. (2010)에서 확인할 수 있습니다.

## Body models for graphics
Anguelov et al. (2005): 골격 모델과 통계적 형태 모델을 결합하여 보다 정교한 모델을 제안하였습니다.

Allen et al. (2003) 및 Seo와 Magnenat-Thalmann (2003): 이들은 PCA를 적용하여 인체의 골격 모델을 연구하였으나, 근육의 움직임에 따른 변형을 모델링하는 요소는 포함하지 않았습니다.

이 연구들은 인체 모델링의 발전에 있어 기초적인 역할을 하였으며, 현재의 기술적 진전을 위한 토대를 마련하였습니다. 

## Hand models
특히 De La Gorce et al. (2008)의 연구는 텍스처, 음영 및 자기 폐색을 상세히 설명하는 고급 모델을 제시하고 있습니다. 이는 손 추적 기술 발전에 있어 중요한 기여입니다.
