# DeshadowNet: A Multi-context Embedding Deep Network for Shadow Removal | Shadow removal

## 1. 핵심 주장 및 주요 기여  
**DeshadowNet**은 전통적인 섀도우 제거 파이프라인(섀도우 검출 → 펜브라/엄브라 분할 → 수작업 복원) 대신, **단일 엔드투엔드 딥 네트워크**로 섀도우 이미지로부터 직접 섀도우 매트를 예측함으로써 섀도우 제거를 자동화한다.  
- **다중 컨텍스트 임베딩**: 전역 구조를 캡처하는 G-Net, 중간 수준의 외관 정보를 취급하는 A-Net, 고수준의 의미 정보를 추출하는 S-Net을 결합하여, 전역 문맥과 로컬 디테일을 동시에 학습.  
- **대규모 벤치마크 SRD**: 3,088쌍의 섀도우/섀도우프리 이미지 데이터셋을 구축·공개하여 연구 기반 확대.  
- **합성 데이터 활용 및 멀티스케일 학습**: 60,000쌍의 합성 데이터 사전학습과 64×64, 128×128, 224×224 멀티스케일 입력으로 일반화 성능 강화.

## 2. 문제 정의, 제안 방법 및 모델 구조  
### 2.1 문제 정의  
입력 섀도우 이미지 $$I_s$$와 그에 대응하는 섀도우 프리 이미지 $$I_{ns}$$ 간 관계는 픽셀 단위로  

$$
I_s = S_m \cdot I_{ns}
$$

로 표현되며, 여기서 $$S_m$$은 빛의 감쇠를 나타내는 **섀도우 매트**이다. 목표는 $$S_m$$을 예측하여  

$$
I_{ns} = I_s \,/\, S_m
$$

를 복원하는 것이다.

### 2.2 네트워크 구조  
DeshadowNet은 세 개의 서브네트워크로 구성된다.  
- **G-Net (Global Localization Network)**: VGG16 기반으로 전역 컨텍스트와 의미 정보를 추출. 마지막 두 풀링 레이어의 스트라이드를 1로 조정해 예측 해상도를 높이고, FC 레이어를 1×1 컨볼루션으로 대체.  
- **A-Net (Appearance Modeling Network)**: G-Net의 중간(shallower) 레이어 특징을 받아 로컬 외관 디테일 강화.  
- **S-Net (Semantic Modeling Network)**: G-Net의 깊은(deeper) 레이어 특징을 받아 고수준 의미 정보 주입.  
이들 출력은 1×1 컨볼루션으로 융합되어 최종 섀도우 매트를 생성한다.

### 2.3 손실 함수 및 학습 전략  
- **로그 변화**를 적용하여  

$$
  \log I_s = \log S_m + \log I_{ns},
  $$
  
$$
  L(\Theta) = \frac{1}{K} \sum_{i=1}^K \bigl\|\log F(I_s^{(i)};\Theta) - \log S_m^{(i)}\bigr\|^2.
  $$

- **다단계 훈련**: G-Net+A-Net, G-Net+S-Net 단계별 학습 후 전체 네트워크 공동 최적화.  
- **데이터 증강 · 합성 사전학습**: 60,000 합성 이미지, 회전·크롭·플립 등.  
- **멀티스케일 입력**: 64, 128, 224 해상도 랜덤 혼합, 스케일 불변성 강화.

## 3. 성능 향상 및 한계  
- **정량 평가**: UIUC, LRSS, SRD 데이터셋에서 RMSE, SSIM 모두 기존 기법 대비 유의한 개선을 보임.  
- **정성 평가**: 다양한 펜브라 폭, 복잡한 의미 구조(다양한 물체 표면)에서도 일관된 제거 성능.  
- **한계**:  
  - 훈련에 **3–5주** 대형 GPU 자원 요구.  
  - 극단적 조명 변화나 비정형 반사·투명체 그림자에서 일반화 한계.  
  - 합성 데이터와 도메인 차이에서 오는 잔여 오차.

## 4. 일반화 성능 향상 관점  
DeshadowNet의 **합성 대규모 사전학습**과 **멀티스케일 훈련** 전략은 다음과 같은 일반화 강점을 가진다.  
- 다양한 조명·장면 조건을 합성 데이터로 커버하여 실제 촬영 도메인의 **데이터 편향 최소화**.  
- 입력 해상도를 다양화함으로써 **스케일 변화에 강한 특징 표현** 학습.  
- 세 개의 컨텍스트 스트림(전역/중간/고수준 의미) 결합이 **복합 조명 상황**에서도 균형 잡힌 복원 기능 제공.

## 5. 향후 연구 영향 및 고려 사항  
이 연구는 **컨텍스트 융합 구조**를 통해 저수준 영상 과제(섀도우, 빗방울·스노우 제거, 하이라이트 보정 등)에 적용 가능성을 보여준다. 미래 연구에서는  
1. **경량화**: 실시간 애플리케이션을 위한 네트워크 압축·지식 증류.  
2. **도메인 적응**: 합성→실제 영상 간 갭을 줄이는 **무감독 적응** 기법.  
3. **다중 모달**: RGB-D나 라이다 데이터 병합으로 **깊이 기반 섀도우** 처리.  
4. **비제한적 조명 변형**: 반사·굴절 효과를 학습하는 **물리 기반 레이어** 도입.  

이로써 DeshadowNet 아키텍처는 다양한 저수준 영상 복원 연구의 **새로운 패러다임**이 될 것으로 기대된다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/0387983c-3d8a-468c-8490-c1693d9e5bc4/Qu_DeshadowNet_A_Multi-Context_CVPR_2017_paper.pdf)
