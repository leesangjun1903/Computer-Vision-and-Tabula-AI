# That’s BAD: Blind Anomaly Detection by Implicit Local Feature Clustering | Anomaly detection
# 핵심 요약

**That’s BAD** 논문은 인간의 정상(비이상) 데이터 없이도 이미지 집합 내에서 이상(anomaly)을 검출하고 국소화하는 새로운 **Blind Anomaly Detection (BAD)** 설정을 제안한다.  
주요 기여:
- BAD 설정 정의: 정상 데이터 사전 지식 없이 혼합된 이미지에서 이상을 검출  
- PatchCluster 기법 제안: 메모리 뱅크 내의 패치 특징을 K-최근접 이웃 클러스터링으로 묶어 국소 분포를 추정하고, 평균 거리로 이상도(abnormality)를 측정  
- 기존 One-Class AD 대비 거의 동등한 성능을 유지하면서 BAD 설정에서 최고 성능 달성 (MVTec AD 평균 이미지 AUROC 97.5%, 픽셀 AUROC 98.2%)  

# 상세 설명

## 1. 해결하고자 하는 문제  
- 전통적 비지도 이상 탐지는 *정상(비이상) 샘플*만을 학습 데이터로 사용(One-Class 설정).  
- 현실적 데이터에는 레이블링된 정상 샘플 확보 자체가 어렵고, 일부 이상 샘플이 섞여 있을 수 있음.  
- **Blind Anomaly Detection (BAD)**: 입력 이미지 집합 S={I₁,…,Iₙ}에는 정상과 이상 이미지가 섞여 있으며, 사전 레이블링된 정상 데이터가 전무한 상황에서 이상 이미지 및 결함 위치를 모두 검출·국소화  

## 2. 제안 방법: PatchCluster  

### 2.1 메모리 뱅크 구축  
1. 사전 학습된 WideResNet-50의 2·3단 레지듀얼 블록에서 다중 스케일 특징 Fˡᵢ ∈ ℝ^(Wˡ×Hˡ×Cˡ) 추출  
2. 위치별 패치 특징 fᵢ(w,h)들을 채널 방향으로 통합, adaptive average pooling 적용  
3. 전체 집합 S의 모든 패치 특징을 메모리 뱅크 M으로 저장  

### 2.2 국소 분포 추정 및 이상 점수  
- BAD에서는 M에 정상뿐 아니라 이상 패치 특징도 포함  
- **가정**: 정상 패치 특징은 밀집 분포(dense), 이상 패치는 분산이 큼  
- 각 테스트 패치 fᵢ(w,h)에 대해 메모리 뱅크에서 **K-최근접 이웃** Gᵢ(w,h) 검색  
- 이상 점수:  

$$
a_{w,h} = \frac{1}{K} \sum_{j\in G_i(w,h)} \mathrm{dist}(f_i(w,h), f_j)
$$

- 픽셀 수준 이상도 맵을 bi-linear 업샘플링 후 Gaussian smoothing으로 정제  
- 이미지 수준 이상 점수: 맵의 최대값 a* 및 해당 패치의 주변 N(f*) 거리 가중 평균  

### 2.3 모델 구조  
- 입력 → WideResNet-50 → 다중 스케일 패치 특징 융합 → 메모리 뱅크  
- 인퍼런스 시 K-NN 기반 로컬 클러스터링 모듈 → 이상도 계산 → 이상 맵 및 이진 분류  

## 3. 성능 향상 및 한계  
- **성능**:  
  - MVTec AD Mix 설정에서 PatchCluster-25%: 이미지 AUROC 97.5%, 픽셀 AUROC 98.2%  
  - Test 설정: 95.7% / 95.9%, Ano 설정(전부 이상): 픽셀 94.3% / PRO 88.3%  
  - 기존 PaDiM, SPADE, PatchCore 대비 전반적 우위  
- **한계**:  
  - 메모리 뱅크 크기에 민감: subsampling 비율이 너무 낮으면 픽셀 감도가 급락  
  - 케이블 등 정상 패치의 변동이 큰 품목이나, 결함 영역이 지나치게 국부적·세밀할 경우 성능 저하  
  - K 값 및 subsampling 비율은 데이터셋 규모·분포에 종속적  

# 모델 일반화 성능 향상 관점

- **로컬 분포 학습**: 전역 분포 모델링 대신 각 패치 위치 주변의 K-최근접 이웃으로 분포를 추정함으로써, 클래스별 편향 없이 다양한 제품군에 적용 가능  
- **코어셋 서브샘플링**: 메모리 뱅크 내 잡음성 패치 필터링 효과, 적절한 비율에서 일반화 성능↑  
- **하이퍼파라미터 안정성**: K 값을 평균 카테고리별 샘플 수 근처로 설정하면(예: K≈100) BAD 설정 전반에 걸쳐 성능이 크게 변동하지 않음  
- **사전 학습된 특징 활용**: ImageNet 편향 없이 산업적 결함에도 강건한 중간 레벨 특징 사용  

# 향후 연구 영향 및 고려 사항

- BAD 설정은 **비지도 이상 검출** 연구의 새로운 표준이 될 수 있으며, 라벨링 비용이 큰 산업 도메인에 실용적  
- 후속 연구 시 고려해야 할 점:  
  1. 메모리 뱅크 관리: 동적 업데이트, 압축 기법 도입으로 메모리·연산 효율 극대화  
  2. 자율 K-추정: 데이터셋 분포에 맞춘 K 최적화 알고리즘 개발  
  3. 도메인 불일치 적응: 다양한 제품군과 촬영 조건 변화에 대한 강건성 평가 및 도메인 적응 기법 통합  
  4. 이상도 지도 학습 결합: 소량의 레이블이 있을 때 학습 효율 향상을 위한 반지도학습 프레임워크 검토  

That’s BAD는 완전 무라벨 환경에서 이상 검출 문제에 대한 새로운 시각을 제시했으며, 산업 적용성을 높이기 위한 후속 연구의 기틀을 마련했다.

[1] https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/10368862-fcc5-4b68-9b72-e12429c8fbc2/2307.03243v1.pdf
