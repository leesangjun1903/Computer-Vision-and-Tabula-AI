# Shadow Removal via Shadow Image Decomposition | Shadow removal

## 1. 핵심 주장 및 주요 기여
이 논문은 전통적인 물리 기반 조명 모델과 딥러닝의 장점을 결합하여 단일 이미지에서 그림자를 효과적으로 제거하는 새로운 프레임워크를 제안한다. 주요 기여는 다음과 같다:  
-  선형 조명 모델에 기반한 **그림자 파라미터**(스케일링 및 바이어스) 추정  
-  **그림자 매트(soft matte)** 예측을 위한 딥 네트워크 설계  
-  제안 기법이 기존 최첨단 방법 대비 ISTD 데이터셋에서 **그림자 영역 RMSE를 40%→22% 수준으로 대폭 감소**  
-  선형 모델을 활용한 **그림자 편집·합성**으로 데이터 증강을 수행, 추가 학습 시 RMSE를 7.9→7.4까지 추가 향상  

## 2. 문제 정의
그림자는 컴퓨터 비전 알고리즘에서 윤곽 감지나 물체 인식 시 간섭 요소로 작용한다. 기존 방법은  
– 물리 기반 모델에 의존하여 직접 조명·간접 조명 계수를 최적화하거나  
– 딥러닝을 통해 입력→그림자 제거 이미지 매핑을 수행  
하였으나, 전자는 시간이 오래 걸리며 사용자 개입이 필요하고, 후자는 생성 결과가 블러링·아티팩트 문제를 갖는다.  

## 3. 제안 방법
### 3.1 선형 조명 모델  
그림자 영역 픽셀 $$I_{\text{shadow}}(k)$$와 비그림자 픽셀 $$I_{\text{shadow-free}}(k)$$ 간의 관계를 채널별 선형 함수로 가정:  

$$
I_{\text{shadow-free}}(k) = w_k \, I_{\text{shadow}}(k) + b_k
$$  

여기서 $$\mathbf w=[w_R,w_G,w_B]$$, $$\mathbf b=[b_R,b_G,b_B]$$는 umbra 전체에 걸쳐 일정한 파라미터 벡터이다.  

### 3.2 이미지 분해 모델  
그림자 제거 이미지를 아래와 같이 두 이미지의 가중 합으로 표현:  

$$
I_{\text{shadow-free}} = \alpha \cdot I_{\text{shadow}} + (1-\alpha)\cdot I_{\text{relit}}
$$  

$$
I_{\text{relit}} = \mathbf w \odot I_{\text{shadow}} + \mathbf b
$$  

$$\alpha$$는 픽셀별 그림자 농도를 나타내는 매트(layer)로, penumbra 영역의 부드러운 경계 처리에 핵심적이다.

## 4. 모델 구조
– **SP-Net**: ResNeXt 기반 네트워크로, 입력 그림자 이미지와 이진 그림자 마스크로부터 $$(\mathbf w,\mathbf b)$$를 회귀 예측  
– **M-Net**: U-Net 구조로, 입력 그림자 이미지·relit 이미지·그림자 마스크를 받아 픽셀별 매트 $$\alpha$$ 예측  
학습 손실: SP-Net은 L1 regression loss, M-Net은 최종 재구성 결과와 GT 이미지 간 L1 reconstruction loss  

## 5. 성능 향상 및 한계
– **성능**: ISTD 테스트에서 그림자 영역 RMSE를 기존 13.3→9.5(29%↓, SP-Net)→7.9(17%↓, SP+M-Net)까지 낮춤.  
– **데이터 증강**: 조명 파라미터를 변형해 합성 그림자를 생성, 학습 데이터 4배 증강 시 RMSE 7.9→7.4 추가 개선  
– **한계**:  
  1. 복잡한 다중광원·컬러벌룬 환경에서 선형 모델 가정의 한계  
  2. 그림자 마스크 의존으로 검출 오류 발생 시 성능 저하  
  3. 과도한 relighting으로 인한 색상 부조화 사례  

## 6. 일반화 및 향후 연구 고려사항
– **일반화**: 물리 기반 파라미터 추정과 매트 예측 분리 학습 구조는 다양한 조명·장면에 확장 가능.  
– **고려사항**:  
  1. 비선형·스펙트럼 특성 반영한 고차원 조명 모델 통합  
  2. 마스크 없이 end-to-end 예측으로 검출 종속성 제거  
  3. 자율 생성된 합성 데이터와 실촬영 데이터 간 도메인 격차 해소 기법 도입  

## 7. 향후 영향 및 연구 과제
이 접근법은 그림자 제거뿐 아니라 물리 기반 이미지 편집·합성, 조명 인버전, AR 응용 등 다양한 분야의 **딥러닝-물리 모델 융합** 연구를 촉진할 것으로 기대된다. 후속 연구에서는 보다 현실적인 조명 모델 개발, 도메인 적응, 자체 검출 통합 구조 설계 등을 통해 **실세계 애플리케이션에 적용 가능한** 범용성 높은 시스템 구축이 필요하다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/e1c5d185-a085-4a26-ad42-8950c0e24912/1908.08628v1.pdf)
