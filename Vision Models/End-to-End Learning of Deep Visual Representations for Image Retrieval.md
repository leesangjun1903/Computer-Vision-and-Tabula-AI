# End-to-End Learning of Deep Visual Representations for Image Retrieval | Image retrieval

## 핵심 주장 및 주요 기여  
본 논문은 인스턴스 수준 이미지 검색(instance-level image retrieval)에서 기존의 국소 특징 매칭 방법보다 효율적이면서도 정확도가 뛰어난 전역 이미지 표현(global image representation)을 학습하는 새로운 엔드-투-엔드(end-to-end) 딥 러닝 프레임워크를 제안한다. 세 가지 핵심 기여는 다음과 같다.  
첫째, 잡음이 많은 랜드마크 데이터셋을 자동 정제(cleaning)하여 인스턴스 검색에 적합한 학습용 데이터로 변환했다.  
둘째, 기존 R-MAC(regional maximum activations of convolutions)를 완전 미분 가능 네트워크로 재해석하고, 삼중항(triplet) 순위 손실(ranking loss)을 통해 엔드-투-엔드로 최적화했다.  
셋째, 제안된 표현력에 기반한 다양한 개선: (1) 지역 제안 네트워크(region proposal network)를 도입하여 배경 클러터를 줄이고, (2) 다중 해상도(multi-resolution) 입력을 통합해 스케일 변화에 강인한 표현을 학습했다.

## 해결 과제  
인스턴스 검색은 동일 객체 인스턴스를 대규모 이미지베이스에서 찾아내는 문제로, 전통적인 SIFT 기반 지역 디스크립터 매칭 및 공간 검증(spatial verification)에 높은 계산 비용이 든다. 반면, CNN 기반 전역 표현은 효율적이나 성능이 열위였다. 기존 CNN 특징을 R-MAC에 수동 결합한 방식은 분류(classification) 목적의 사전학습(pretrained)을 그대로 활용하기에, 인스턴스 구별 능력이 부족했다.

## 제안 방법  
논문은 R-MAC 파이프라인을 하나의 CNN으로 통합하며, 학습 가능한 파라미터로 구성한다.  
– **삼중항 순위 손실:** 쿼리 $$q$$, 양성 $$d^+$$, 음성 $$d^-$$ 표현 간 거리를  

$$
L(q,d^+,d^-) = \tfrac12 \max\bigl(0,\, m + \lVert q - d^+\rVert^2 - \lVert q - d^-\rVert^2\bigr)
$$  

로 정의해, 양성은 더 가깝고 음성은 더 멀어지도록 최적화한다.  

– **지역 제안 네트워크:** Affine 매칭을 통해 자동 생성한 바운딩 박스 레이블로 RPN을 학습, 배경 비율이 높은 R-MAC 영역을 대체해 특징의 품질을 높인다.  
– **다중 해상도 합성:** (550, 800, 1050) 크기로 이미지를 변환한 뒤 각 해상도 표현을 합산·정규화해 스케일 내성을 강화한다.

## 모델 구조  
1. 입력 이미지를 CNN에 통과시켜 “완전 컨볼루션” 특징 맵을 생성  
2. 고정 그리드 대신 학습된 RPN이 제안한 k개 영역 ROI-풀링  
3. 지역별 풀링 결과에 PCA(shift+FC 레이어)와 ℓ₂ 정규화를 적용  
4. 지역 임베딩을 합산한 후 최종 ℓ₂ 정규화  
5. 삼중항 네트워크로 이미지 쌍(양성·음성)을 동시에 처리해 순위 손실 역전파  

> 전체 그래디언트 흐름이 미분 가능해 엔드-투-엔드 학습이 가능하다.

## 성능 향상  
ResNet-101 기반 모델을 랜드마크 데이터로 순위 학습한 후, Oxford 5k에서 86.1 mAP, Paris 6k에서 94.5 mAP를 달성하며 기존 R-MAC 대비 각각 +16.7, +9.3 mAP의 대폭 향상을 보였다. 추가로 쿼리 확장(QE)과 데이터베이스 보강(DBA)을 적용 시 Oxford 5k에서 94.7 mAP, Paris 6k에서 96.6 mAP에 도달해 종전 복합 검증 기법에 필적하거나 능가하는 정확도를 기록했다.  

## 한계 및 일반화 성능  
랜드마크 도메인에서 큰 성공을 거두었으나, UKB(일상용품) 데이터셋에서는 자연 이미지 간 도메인 차이로 인해 소폭 성능 하락을 보였다. 이는 학습 데이터 분포가 일반 이미지와 다르면 표현의 일반화 능력이 떨어질 수 있음을 시사한다. 다만, mAP 하락폭이 크지 않아 추가 도메인 적응 없이도 어느 정도 범용성이 있음을 알 수 있다.

## 연구의 영향 및 향후 고려사항  
이 연구는 인스턴스 검색을 위한 전역 CNN 표현의 새로운 기준을 제시하며, 후속 연구에서 다음 사항을 고려할 필요가 있다.  
– 비(非)랜드마크 도메인에 적합한 라벨링 없는(self-supervised) 정제 또는 도메인 적응 전략  
– RPN 기반 세분된 관심 영역 학습의 자동화 및 손실 통합(end-to-end RPN + 순위 손실)  
– 영상 회전·조명·스크래치 등 비강인 조건에 대한 추가적인 변환 불변 학습  
– 초경량 모바일·임베디드 환경을 위한 극소용량 코드 최적화 및 양자화  

향후 다양한 도메인에서 확장성과 적응력을 강화하는 방향으로 연구가 진행될 것으로 기대된다.

[1] https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/ac292131-5d95-4860-aaa8-734591ca6b2c/1610.07940v2.pdf
