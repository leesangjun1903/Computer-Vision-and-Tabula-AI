# ST-CGAN : Stacked Conditional Generative Adversarial Networks for Jointly Learning Shadow Detection and Shadow Removal | Shadow detection, Shadow removal
# 주요 주장 및 기여 요약

**핵심 주장**  
이 논문은 그림자 검출과 그림자 제거라는 두 상이한 과제를 하나의 통합된 프레임워크(ST-CGAN)로 **종단 간(end-to-end)** 학습함으로써, 두 과제 간의 상호 보완적 이점을 동시에 활용하여 **성능을 크게 향상**시킬 수 있음을 보인다.

**주요 기여**  
1. 최초의 **통합 멀티태스크** 그림자 이해 프레임워크 제안.  
2. Stacked Conditional GAN 구조를 도입하여, 그림자 검출과 제거를 단계적으로 연결(스택)함으로써 전 단계의 출력이 후 단계 입력에 활용되는 **유기적 정보 흐름** 설계.  
3. 그림자 이미지, 그림자 마스크, 그림자 제거 이미지의 **3중(Triplet) 대규모 데이터셋(ISTD)** 공개(1870 triplet).  
4. 두 과제를 동시에 학습할 때, 단일 과제 학습이나 다중-브랜치 방식 대비 우수한 **일반화 성능** 입증.  

***

## 1. 해결하고자 하는 문제

- 기존 연구는 그림자 검출(Shadow Detection)과 그림자 제거(Shadow Removal)를 **분리**하여 다루거나, 제거 단계만 그림자 위치 정보를 간접 활용하는 방식에 한정됨.  
- 두 과제는 그림자 마스크와 그림자 제거 결과 간에 **강한 상관관계**를 가지므로, 이를 **동시에** 학습할 경우 서로의 성능을 끌어올릴 수 있다는 잠재력을 활용하지 못함.

## 2. 제안하는 방법

### 2.1 모델 개요

- **ST-CGAN**: 두 개의 CGAN을 **스택(계단식)** 구조로 결합  
  1. G₁/D₁: 입력 그림자 이미지 $$x$$ → 그림자 마스크 $$\hat{y}=G₁(x)$$  
  2. G₂/D₂: $$(x,\hat{y})$$ → 그림자 제거 이미지 $$\hat{r}=G₂(x,\hat{y})$$  

### 2.2 손실 함수

```math
\begin{aligned}
\mathcal{L}_{\text{CGAN1}}(G_1,D_1)&=\mathbb{E}_{x,y}[\log D_1(x,y)] + \mathbb{E}_{x}[\log(1-D_1(x,G_1(x)))],\\
\mathcal{L}_{\text{data1}}(G_1)&=\mathbb{E}_{x,y}\bigl\|\,y - G_1(x)\bigr\|_1,\\
\mathcal{L}_{\text{CGAN2}}(G_2,D_2|G_1)&=\mathbb{E}_{x,y,r}[\log D_2(x,y,r)] + \mathbb{E}_{x}[\log(1-D_2(x,G_1(x),G_2(x,G_1(x))))],\\
\mathcal{L}_{\text{data2}}(G_2|G_1)&=\mathbb{E}_{x,r}\bigl\|\,r - G_2(x,G_1(x))\bigr\|_1.
\end{aligned}
```

최종 최적화:

```math
\min_{G_1,G_2}\max_{D_1,D_2}\;\mathcal{L}_{\text{data1}} + \lambda_1\mathcal{L}_{\text{data2}}
+\lambda_2\mathcal{L}_{\text{CGAN1}}+\lambda_3\mathcal{L}_{\text{CGAN2}}.
```

### 2.3 모델 구조

- **Generator**: U-Net 기반 인코더–디코더 구조  
- **Discriminator**: PatchGAN 스타일, D₁는 4채널(x+mask), D₂는 7채널(x+mask+제거) 입력  
- **스택 연결**: G₁의 출력이 G₂에 연결될 뿐만 아니라, 역전파 시 G₂의 그래디언트가 G₁으로 전달되어 **상호 학습 강화**  

## 3. 성능 향상 및 한계

- **성능 향상**:  
  - SBU, UCF, ISTD 데이터셋 전반에서 그림자 검출 BER 및 제거 RMSE에서 기존 기법 대비 **10–20%** 이상의 성능 개선  
  - 다중-브랜치 방식 대비 검출 BER 3.85% vs 4.77%, 제거 RMSE 7.47 vs 7.84 등 일관된 우위  

- **한계**:  
  - 조명 조건이 극단적으로 변화하는 실외 고난이도 환경에서는 학습된 조건부 분포의 범위를 벗어나면 일반화 성능이 다소 떨어질 가능성  
  - 데이터셋은 주로 평면 지면 위 그림자에 초점, 복잡한 구조물 그림자나 유동 객체 그림자에는 미검증  

## 4. 일반화 성능 향상 관점

- **스택 아키텍처**는 전 단계에서 학습된 그림자 형태 정보가 후 단계 제거 모델에 직접 제공되어, 낯선 조명·배경에서도 그림자 패턴 인식이 강화됨.  
- **조건부 적대적 손실**은 고주파 디테일과 전역 일관성을 동시에 학습, 특히 **미세 그림자 경계** 검출 및 자연스러운 제거에 기여.  
- **데이터셋 다양성**(135개 씬, 다양한 조명·형태) 덕분에, 학습된 모델이 실제 촬영 환경 변화에도 강건하게 대응할 가능성 증대.

## 5. 향후 연구에 미치는 영향 및 고려점

- **영향**:  
  - 멀티태스크 이미지-투-이미지 변환 연구에서 **스택형 CGAN** 패러다임 확산  
  - 그림자 이해 외에도 **전이 학습** 가능한 유사 멀티태스크(예: 노이즈 제거+세분화) 모델 개발 촉진  

- **고려점**:  
  - 비정형 조명·복잡도 높은 3D 구조물 그림자를 아우르는 **데이터셋 확장**  
  - 실시간 처리를 위한 **경량화 및 지연 최적화**  
  - 적대적 학습의 불안정성을 완화할 **안정적 최적화 기법** 적용 연구 필요

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/678163a0-2966-4c83-a63d-c022c6f7fed6/1712.02478v1.pdf)
