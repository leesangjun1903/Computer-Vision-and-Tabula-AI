# Refusion: Enabling Large-Size Realistic Image Restoration with Latent-Space Diffusion Models | Image denoising, Image dehazing, Image restoration, Super resolution

# 핵심 요약

**Refusion**은 실제 크기의 고해상도 이미지(2K–6K 해상도) 복원을 위해 확산 모델(diffusion model)의 효율성과 안정성을 대폭 향상시킨 기법이다.  
주요 기여는 다음과 같다:
1. U-Net 기반 **라텐트(latent) 확산**으로 고해상도 이미지를 저해상도 잠재 공간에서 복원함으로써 계산량을 15배 이상 감소.  
2. 비선형 활성화가 제거된 **NAFNet** 블록을 활용해 노이즈 예측의 성능과 속도 향상.  
3. 노이즈 수준, 디노이징 스텝, 학습 이미지 크기, 옵티마이저/스케줄러 등 하이퍼파라미터의 체계적 탐색을 통해 복원 품질(왜곡·지각) 개선.  
4. 실제 그림자 제거, 스테레오 초해상도, 보케 변환, 비균질 고해상도 제모(비제이징) 등 다양한 복원 과제에 단일 모델 구조로 적용 가능.  

# 문제 정의 및 제안 기법

## 해결하고자 하는 문제  
- 실제 산업 현장에서 요구되는 대형(Large-Size) 이미지(수천만 화소) 복원 과제는  
  1) 복잡한 왜곡(흐림·안개·그림자·렌즈 효과)  
  2) 임의 크기의 초고해상도  
  를 동시에 처리해야 하나, 기존 확산 모델은 계산·메모리 한계로 적용 불가능.

## 제안 모델 개요  
1. **IR-SDE 기반 확산 복원**  
   - Mean-reverting SDE(식 (1))를 전방향 오염 프로세스로, 역방향 복원(식 (3))으로 HQ 이미지 회복  
   - 노이즈 예측 목표: $$\nabla_x\log p_t(x)=-\frac{x(t)-m_t}{v_t}$$ (식 (4))

2. **U-Net 라텐트 확산 구조**  
   - 입력 LQ 이미지 $$\to$$ U-Net 인코더로 저해상도 잠재 표현 $$z$$ 생성  
   - 잠재 공간에서 IR-SDE 역방향(diffusion) 수행  
   - 디코더의 스킵 커넥션(skip-connections)을 통해 고해상도 세부 정보 보존하며 HQ 이미지 재구성  

3. **NAFNet 기반 노이즈 예측 네트워크**  
   - 전통적 U-Net 대신 NAFBlock: 활성화 대신 채널 분할·곱(SimpleGate), 시간 임베딩 처리 MLP 추가  
   - 파라미터 수·FLOPs 감소, 그림자 제거 PSNR 학습 곡선에서 U-Net 대비 우수[그림 6]

4. **하이퍼파라미터 최적화**  
   - 노이즈 수준 $$\sigma\in\{10,30,50,70\}$$ 중 $$\sigma=50$$ 안정적[그림 5a]  
   - 디노이징 스텝 100 vs 1000: 소수 단계도 동급 품질[그림 5b]  
   - 학습 패치 크기 256×256이 128×128 대비 우수[그림 5c]  
   - 옵티마이저 + 스케줄러: Lion + CosineDecay 최적[그림 5d]  

# 성능 평가 및 한계

| Task                      | 지표            | 기존 IR-SDE | Refusion   | Latent Refusion |
|---------------------------|-----------------|-------------|------------|-----------------|
| 스테레오 초해상도         | LPIPS↓ / FID↓   | 0.197/25.6s | 0.155/22.4s| —               |
| 그림자 제거               | PSNR↑ / LPIPS↓  | 20.30/0.152 | 21.88/0.121| —               |
| 보케 변환                 | LPIPS↓ / FID↓   | —           | 0.053/20.4s| 0.047/24.3s     |
| 비균질 고해상도 제모     | 적용 불가      | 불가        | 불가       | 처리 성공 (6000×4000) |

- **성능 향상**: 전 분야에서 LPIPS, FID 등 지각 품질 지표 우수. 그림자 제거 NTIRE 2023 2위(Perceptual 최고)[Table 5].  
- **계산 효율**: 라텐트 방식을 통해 FLOPs 119→4G로 급감[Table 4].  
- **한계**:  
  - 라텐트 압축 과정 학습 안정성은 높으나, VAE-GAN 방식 대비 복원 왜곡의 한계 가능성.  
  - 특정 과제별 입력 특징(렌즈 정보, 듀얼 뷰) 반영 위한 네트워크 수정 필요.

# 일반화 성능 및 향후 연구 시 고려사항

- **데이터셋 교체 만으로 다중 과제 대응**: 그림자·제모·보케·스테레오 등 서로 다른 왜곡 특성에 별도 파라미터 튜닝 없이 적용 가능→일반화 유망.  
- **라텐트 공간 작용 범위**: 고해상도 이미지를 저해상도 잠재에 압축함으로써 복원 성능 저하 위험 존재. 향후 잠재 표현의 정보 보존 한계 연구 필요.  
- **하이퍼파라미터 민감도**: 노이즈 수준·스텝 수 등 설정에 따라 성능 차이 크므로, 새로운 복원 과제 도입 시 체계적 탐색 필수.  

# 향후 영향 및 연구 과제

Refusion은 대형 실사 이미지 복원에 **확산 기반 라텐트 모델**이 적용 가능함을 입증했다.  
- **실시간 고해상도 복원**: 라텐트 압축 전략을 고속화 기술과 결합해 모바일·임베디드 환경 활용  
- **다중 왜곡 혼합 복원**: 복합적 열화(안개+소음+모션 블러) 동시 해결 연구  
- **잠재 표현 학습 강화**: 자가지도·대조학습으로 잠재 공간에 왜곡 정보·질감 보존성 향상  

앞으로는 라텐트 모델의 정보 손실 저감을 위한 압축-복원 상호 최적화, 그리고 복원 과제별 적응형 노이즈 스케줄링 전략 개발이 중요한 연구 방향이 될 것이다.

[1] https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/b8cf1161-2467-4d20-81a3-2cd9f550b40f/2304.08291v1.pdf
