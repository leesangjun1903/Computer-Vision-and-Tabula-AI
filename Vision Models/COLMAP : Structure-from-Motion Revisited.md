# COLMAP : Structure-from-Motion Revisited | 3D reconstruction

## 주요 주장  
Incremental Structure-from-Motion(SfM) 시스템들은 인터넷 사진 컬렉션으로부터 3D 재구성을 수행하는 데 널리 쓰여 왔으나, **강인성**, **정확도**, **완전성**, **확장성** 측면에서 여전히 한계가 존재한다. 이 논문은 이 네 가지 핵심 과제를 동시에 개선하여 “진정한 범용 SfM 파이프라인”에 한걸음 더 다가갈 수 있는 새로운 알고리즘을 제안한다.  

## 해결하고자 하는 문제  
1. **불완전한 장면 그래프**  
   – 매칭·검증 단계에서의 부정확성으로 인해 충분한 연결성과 중복 정보가 확보되지 않음  
2. **이미지 등록 및 삼각화 상호 의존성**  
   – 이미지 등록을 위해서는 기존 구조가 필요하고, 구조 삼각화를 위해서는 등록된 이미지가 필요하여 상호 순환적 오류 발생  
3. **드리프트·부정확성 누적**  
   – 번들 조정(BA) 시 누적 오차와 아웃라이어로 인해 모델이 비현실적으로 왜곡됨  
4. **대규모·밀집 컬렉션에서의 효율성**  
   – BA와 매칭의 고비용으로 인해 수십만 장 이상의 사진 처리 시 병목 발생  

## 제안 기법  

### 1. 장면 그래프 보강 (Scene Graph Augmentation)  
– 다중 모델(기본행렬, 호모그래피, 유사변환) 기하 검증으로 각 이미지 페어를 일반, 파노라마, 평면으로 분류  
– 워터마크·타임스탬프 등 잘못된 매칭(“WTF”) 필터링  
– 비파노라마·교정된 카메라 페어만 초기화에 활용  

### 2. 차기 등록 뷰 선택 (Next Best View Selection)  
– **점수 함수 Si**: 이미지 내 가시화된 2D-3D 점들의 개수와 분포 균일성을 다중 해상도(피라미드)로 평가  
– 픽셀 그리드 수식  

```math
S_i = \sum_{l=1}^L w_l \times \#\{\text{새롭게 채워진 셀 at level }l\},\quad w_l=K_l^2,\ K_l=2^l
```

– 분포적 균일성과 가시점 수를 동시에 높이는 이미지부터 등록하여 드리프트 최소화  

### 3. 강인하고 효율적인 삼각화 (Robust and Efficient Triangulation)  
– RANSAC 기반 반복적(recursive) 다중 뷰 삼각화  
– 두 뷰 샘플링으로 초기 모델 $$X_{ab}=\tau(\bar x_a,\bar x_b,P_a,P_b)$$ 구한 뒤 재귀적으로 인라이어 검증 및 남은 트랙 분리  
– Cheirality (depth >0) 및 reprojection error  $$\alpha$$ 조건 사용  

### 4. 반복적 번들 조정 및 재삼각화 (Iterative BA & Re-Triangulation)  
– 국소 BA(Local BA) → 전역 BA(Global BA) 사이에 재삼각화(Pre-/Post-BA RT) 및 아웃라이어 필터링  
– Cauchy robust loss, inexact PCG/direct solver 선택  
– BA→RT→필터링 반복 최적화로 드리프트 완화  

### 5. 중복 뷰 군집화로 효율화된 BA (Redundant View Mining)  
– **카메라 그룹화**: 서로 유사 가시점 벡터 간 유사도 $$V_{ab}=\|v_a\land v_b\|/\|v_a\lor v_b\|$$ 최대 이웃 카메라들을 그룹화  
– 각 그룹을 단일 “가상 카메라”로 취급하여 BA 파라미터 수 대폭 감소  
– 유효한 군집화 임계치 $$V$$ 조정으로 속도/정확도 절충  

## 성능 개선 및 한계  
- **완전성(Registered Images)**: 기존 Bundler·VisualSFM 대비 1.5–3배 이상 등록 이미지 수 증가[Table 1].  
- **정확도**: Quad 데이터셋에서 위치 오차 중간값 0.85 m로 최고 성능 달성.  
- **효율성**: 대규모(75K 이미지) Rome 세트에서 21K 등록 완료, 50배 빠른 Bundler 대비 속도 우수.  
- **제한점**:  
  – 피라미드 기반 점수 매커니즘은 극단적으로 클러스터된 관측에는 덜 민감.  
  – 그룹화된 BA에서 큰 군집을 형성하면 아웃라이어 영향 감소가 어려워질 수 있음.  
  – 제안 기법 다수는 복잡한 매개변수(임계치 $$t$$, $$\alpha$$, $$V$$, $$L$$) 튜닝이 필요.  

## 모델 일반화 성능 향상 관점  
– **다중 모델 검증**으로 장면 특성(파노라마·평면·왜곡) 자동 분류 → 다양한 촬영 조건에 강인  
– **재귀적 삼각화**로 높은 아웃라이어율에도 적응 → 인터넷 사진 컬렉션 전반으로 적용 가능  
– **유연한 BA 군집화**를 통해 데이터셋 규모와 밀도에 따라 최적 구성 유도 → 현장·항공·매핑용 이미지에 확장  

## 향후 연구 방향 및 고려 사항  
1. **자기 학습 임계치 최적화**: 매개변수 자동 조절·메타러닝 적용으로 사용자 개입 최소화  
2. **심층 학습 기반 피처 통합**: SIFT 이후 학습된 표현(feature)과 불확실성 추정 결합해 점수 함수 개선  
3. **실시간·온라인 SfM**: 중복 뷰 군집화를 스트리밍 환경으로 확장하여 드론·로봇에 바로 적용  
4. **하이브리드 전역-증분 통합**: 전역 최적화(global pose graph)와 제안된 증분 방법 융합해 대규모 안정성 극대화  

이 논문은 **증분 SfM의 전 범위**(매칭→검증→등록→삼각화→BA)에 걸쳐 강인성·완전성·효율성을 혁신적으로 개선함으로써, 향후 **산업 응용**과 **대규모 오픈 이미지 컬렉션** 처리에 핵심적 기반을 제공할 것이다.

[1] https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/22370781/f655fcf5-b93a-46c0-99b7-8046478ecaec/Schonberger_Structure-From-Motion_Revisited_CVPR_2016_paper.pdf
